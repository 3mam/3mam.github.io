!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=5)}([function(t,e,i){var n=i(1),s=i(2);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var r={insert:"head",singleton:!1};n(s,r);t.exports=s.locals||{}},function(t,e,i){"use strict";var n,s=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},r=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),a=[];function o(t){for(var e=-1,i=0;i<a.length;i++)if(a[i].identifier===t){e=i;break}return e}function h(t,e){for(var i={},n=[],s=0;s<t.length;s++){var r=t[s],h=e.base?r[0]+e.base:r[0],c=i[h]||0,l="".concat(h," ").concat(c);i[h]=c+1;var u=o(l),d={css:r[1],media:r[2],sourceMap:r[3]};-1!==u?(a[u].references++,a[u].updater(d)):a.push({identifier:l,updater:v(d,e),references:1}),n.push(l)}return n}function c(t){var e=document.createElement("style"),n=t.attributes||{};if(void 0===n.nonce){var s=i.nc;s&&(n.nonce=s)}if(Object.keys(n).forEach((function(t){e.setAttribute(t,n[t])})),"function"==typeof t.insert)t.insert(e);else{var a=r(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var l,u=(l=[],function(t,e){return l[t]=e,l.filter(Boolean).join("\n")});function d(t,e,i,n){var s=i?"":n.media?"@media ".concat(n.media," {").concat(n.css,"}"):n.css;if(t.styleSheet)t.styleSheet.cssText=u(e,s);else{var r=document.createTextNode(s),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function p(t,e,i){var n=i.css,s=i.media,r=i.sourceMap;if(s?t.setAttribute("media",s):t.removeAttribute("media"),r&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var f=null,m=0;function v(t,e){var i,n,s;if(e.singleton){var r=m++;i=f||(f=c(e)),n=d.bind(null,i,r,!1),s=d.bind(null,i,r,!0)}else i=c(e),n=p.bind(null,i,e),s=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else s()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=s());var i=h(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var n=0;n<i.length;n++){var s=o(i[n]);a[s].references--}for(var r=h(t,e),c=0;c<i.length;c++){var l=o(i[c]);0===a[l].references&&(a[l].updater(),a.splice(l,1))}i=r}}}},function(t,e,i){(e=i(3)(!1)).push([t.i,"#glCanvas {\r\n\tpadding: 0;\r\n\tmargin: 0;\r\n\tdisplay: flex;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tbottom: 0;\r\n\tleft: 0;\r\n\tright: 0;\r\n}\r\n\r\n#fullScreen {\r\n\twidth: 5vmax;\r\n\theight: 5vmax;\r\n\tbackground: red;\r\n\tvisibility: hidden;\r\n}\r\n\r\n:fullscreen #fullScreen {\r\n\twidth: 5vmax;\r\n\theight: 5vmax;\r\n\tbackground: greenyellow;\r\n\tvisibility: visible;\r\n}\r\n\r\n.left {\r\n\tposition: absolute;\r\n\ttop: 8vmax;\r\n\tleft: -3vmax;\r\n}\r\n\r\n.up {\r\n\tposition: absolute;\r\n\tleft: 3vmax;\r\n\ttop: 2vmax;\r\n}\r\n\r\n.right {\r\n\tposition: absolute;\r\n\tleft: 9vmax;\r\n\ttop: 8vmax;\r\n}\r\n\r\n.down {\r\n\tposition: absolute;\r\n\tleft: 3vmax;\r\n\ttop: 14vmax;\r\n}\r\n\r\n#input {\r\n\tposition: relative;\r\n}\r\n\r\n#dpad {\r\n\tvisibility: hidden;\r\n}\r\n\r\n:fullscreen #dpad {\r\n\tvisibility: visible;\r\n}\r\n\r\n.button {\r\n\twidth: 7vmax;\r\n\theight: 7vmax;\r\n\tbackground: rgba(255, 255, 255, 0.219);\r\n}\r\n\r\n.startEnd {\r\n\tbackground-color: rgb(59, 168, 114);\r\n\tposition: fixed;\r\n\twidth: 30vmax;\r\n\theight: 10vmax;\r\n\ttext-align: center;\r\n\tfont-size: 9vmax;\r\n}\r\n\r\n#restart {\r\n\tbackground-color: rgb(59, 168, 114);\r\n\ttext-align: center;\r\n\tfont-size: 5vmax;\r\n\tmargin-top: 2vmax;\r\n}\r\n\r\n@media screen and (orientation: portrait) {\r\n\t#dpad {\r\n\t\tposition: fixed;\r\n\t\tleft: 39%;\r\n\t\tbottom: 35%;\r\n\t}\r\n\r\n\t.startEnd {\r\n\t\tleft: 25%;\r\n\t\tbottom: 55%;\r\n\t\tfont-size: 9vmax;\r\n\t}\r\n}\r\n\r\n@media screen and (orientation: landscape) {\r\n\t#dpad {\r\n\t\tposition: fixed;\r\n\t\tright: 30%;\r\n\t\ttop: 30%;\r\n\t}\r\n\r\n\t.startEnd {\r\n\t\tleft: 35%;\r\n\t\tbottom: 50%;\r\n\t}\r\n}\r\n\r\n#end {\r\n\tvisibility: hidden;\r\n}",""]),t.exports=e},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var s=(a=n,o=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),h="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(h," */")),r=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(t," */")}));return[i].concat(r).concat([s]).join("\n")}var a,o,h;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i,n){"string"==typeof t&&(t=[[null,t,""]]);var s={};if(n)for(var r=0;r<this.length;r++){var a=this[r][0];null!=a&&(s[a]=!0)}for(var o=0;o<t.length;o++){var h=[].concat(t[o]);n&&s[h[0]]||(i&&(h[2]?h[2]="".concat(i," and ").concat(h[2]):h[2]=i),e.push(h))}},e}},function(t,e){t.exports='<html> <body> <section> <canvas id=glCanvas></canvas> <section id=input> <div id=fullScreen>EXIT</div> <div class=startEnd id=start> START </div> <div class=startEnd id=end> <div id=restart>RESTART</div> </div> <section id=dpad> <div class="left button" id=left></div> <div class="right button" id=right></div> <div class="down button" id=down></div> <div class="up button" id=up></div> </section> </section> </section> </body> </html>'},function(t,e,i){"use strict";i.r(e);var n,s,r;i(0),i(4);function a(t,e){const i=n.createShader(t);n.shaderSource(i,e),n.compileShader(i);if(n.getShaderParameter(i,n.COMPILE_STATUS))return i;console.log(n.getShaderInfoLog(i)),n.deleteShader(i)}function o(){s.width=window.innerWidth,s.height=window.innerHeight}function h(t){const e=new Array(3),i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return i>1e-5&&(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i),e}function c(t,e){const i=new Array(3);return i[0]=t[1]*e[2]-t[2]*e[1],i[1]=t[2]*e[0]-t[0]*e[2],i[2]=t[0]*e[1]-t[1]*e[0],i}function l(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}function u(t){return t*Math.PI/180}class d{constructor(){this.mat=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.tmp=new Float32Array(16)}translate(t){this.tmpIdentity(),this.tmp[12]=t.valueX(),this.tmp[13]=t.valueY(),this.tmp[14]=t.valueZ(),this.multiply(this.mat,this.tmp)}translateX(t){this.tmpIdentity(),this.tmp[12]=t,this.multiply(this.mat,this.tmp)}translateY(t){this.tmpIdentity(),this.tmp[13]=t,this.multiply(this.mat,this.tmp)}translateZ(t){this.tmpIdentity(),this.tmp[14]=t,this.multiply(this.mat,this.tmp)}position(t){this.translate(t)}scale(t){this.tmpIdentity(),this.tmp[0]=t.valueX(),this.tmp[5]=t.valueY(),this.tmp[10]=t.valueZ(),this.multiply(this.mat,this.tmp)}scaleX(t){this.tmpIdentity(),this.tmp[0]=t,this.multiply(this.mat,this.tmp)}scaleY(t){this.tmpIdentity(),this.tmp[5]=t,this.multiply(this.mat,this.tmp)}scaleZ(t){this.tmpIdentity(),this.tmp[10]=t,this.multiply(this.mat,this.tmp)}rotateX(t){const e=Math.cos(t),i=Math.sin(t);this.tmpIdentity(),this.tmp[5]=e,this.tmp[6]=-i,this.tmp[9]=i,this.tmp[10]=e,this.multiply(this.mat,this.tmp)}rotateY(t){const e=Math.cos(t),i=Math.sin(t);this.tmpIdentity(),this.tmp[0]=e,this.tmp[2]=-i,this.tmp[8]=i,this.tmp[10]=e,this.multiply(this.mat,this.tmp)}rotateZ(t){const e=Math.cos(t),i=Math.sin(t);this.tmpIdentity(),this.tmp[0]=e,this.tmp[1]=-i,this.tmp[4]=i,this.tmp[5]=e,this.multiply(this.mat,this.tmp)}rotation(t){this.rotateX(t.valueX()),this.rotateY(t.valueY()),this.rotateZ(t.valueZ())}identity(){this.mat.fill(0),this.mat[0]=1,this.mat[5]=1,this.mat[10]=1,this.mat[15]=1}tmpIdentity(){this.tmp.fill(0),this.tmp[0]=1,this.tmp[5]=1,this.tmp[10]=1,this.tmp[15]=1}get(){return this.mat}set(t){this.mat.set(t)}orthographic(t,e,i,n,s,r){this.tmp.set([2/(e-t),0,0,0,0,2/(n-i),0,0,0,0,2/(s-r),0,(t+e)/(t-e),(i+n)/(i-n),(s+r)/(s-r),1]),this.multiply(this.mat,this.tmp)}perspective(t,e,i,n){const s=t*Math.PI/180,r=Math.tan(.5*Math.PI-.5*s),a=1/(i-n);this.tmpIdentity(),this.tmp[0]=r/e,this.tmp[5]=r,this.tmp[10]=(i+n)*a,this.tmp[11]=-1,this.tmp[14]=i*n*a*2,this.tmp[15]=0,this.multiply(this.mat,this.tmp)}lookAt(t,e,i){const n=h(function(t,e){const i=new Array(3);return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}(t,e)),s=h(c(i,n)),r=h(c(n,s));this.tmp.set([s[0],s[1],s[2],0,r[0],r[1],r[2],0,n[0],n[1],n[2],0,0,0,0,1]),this.multiply(this.mat,this.tmp)}multiply(t,e){const i=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],n=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],s=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],r=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],a=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],o=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],h=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],c=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],l=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],u=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],d=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],p=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],f=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],m=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],v=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],y=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15];this.mat[0]=i,this.mat[1]=n,this.mat[2]=s,this.mat[3]=r,this.mat[4]=a,this.mat[5]=o,this.mat[6]=h,this.mat[7]=c,this.mat[8]=l,this.mat[9]=u,this.mat[10]=d,this.mat[11]=p,this.mat[12]=f,this.mat[13]=m,this.mat[14]=v,this.mat[15]=y}}!function(t){t[t.Vertex=0]="Vertex",t[t.Instance=1]="Instance",t[t.Uniform=2]="Uniform",t[t.Texture=3]="Texture",t[t.Matrix=4]="Matrix",t[t.UV=5]="UV",t[t.Mat4=6]="Mat4",t[t.Float=7]="Float",t[t.Vec4=8]="Vec4"}(r||(r={}));class p{constructor(){this.viewport=new d;const t=a(n.VERTEX_SHADER,"#version 300 es\n\t\tin vec4 VERTEX;\n\t\tin mat4 INSTANCE;\n\t\tin vec2 inUV;\n\t\tout vec2 UV;\n\t\tuniform mat4 VIEWPORT;\n\t\tuniform mat4 CAMERA;\n\t\t\n\t\tvoid main() {\n\t\t\tUV = inUV;\n\t\t\tgl_Position = CAMERA * VIEWPORT * INSTANCE * VERTEX;\n\t\t}\n\t\t"),e=a(n.FRAGMENT_SHADER,"#version 300 es\n\t\tprecision mediump float;\n\t\tin vec2 UV;\n\t\tout vec4 outColor;\n\t\tuniform sampler2D TEXTURE;\n\t\tuniform vec4 COLOR;\n\t\tvoid main() {\n\t\t\toutColor = texture(TEXTURE, UV)*COLOR;\n\t\t}\n\t\t");this.program=function(t,e){const i=n.createProgram();if(n.attachShader(i,t),n.attachShader(i,e),n.linkProgram(i),n.getProgramParameter(i,n.LINK_STATUS))return i;console.log(n.getProgramInfoLog(i)),n.deleteProgram(i)}(t,e),this.varList=new Map,this.varList.set("VERTEX",{type:r.Vertex,handle:null,var:null}),this.varList.set("INSTANCE",{type:r.Instance,handle:null,var:null}),this.varList.set("inUV",{type:r.UV,handle:null,var:null}),this.varList.set("VIEWPORT",{type:r.Matrix,handle:null,var:null}),this.varList.set("CAMERA",{type:r.Matrix,handle:null,var:null}),this.varList.set("TEXTURE",{type:r.Texture,handle:null,var:null}),this.varList.set("COLOR",{type:r.Vec4,handle:null,var:null}),this.varList.forEach((t,e)=>{switch(t.type){case r.Vertex:case r.UV:case r.Instance:t.handle=n.getAttribLocation(this.program,e);break;case r.Texture:case r.Matrix:case r.Mat4:case r.Vec4:case r.Float:t.handle=n.getUniformLocation(this.program,e)}})}set(t,e){this.varList.get(t).var=e}setColor(t){this.varList.get("COLOR").var=[t.r,t.g,t.b,t.a]}setViewport(t){this.varList.get("VIEWPORT").var=t}setCamera(t){this.varList.get("CAMERA").var=t.getView()}setUV(t){this.varList.get("inUV").var=t}setVertex(t){this.varList.get("VERTEX").var=t}setTexture(t){this.varList.get("TEXTURE").var=t}setInstance(t){this.varList.get("INSTANCE").var=t}update(){n.useProgram(this.program),this.varList.forEach(t=>{switch(t.type){case r.Vertex:n.bindBuffer(n.ARRAY_BUFFER,t.var.id),n.enableVertexAttribArray(t.handle),n.vertexAttribPointer(t.handle,3,n.FLOAT,!1,12,t.var.offset);break;case r.UV:n.bindBuffer(n.ARRAY_BUFFER,t.var.id),n.enableVertexAttribArray(t.handle),n.vertexAttribPointer(t.handle,2,n.FLOAT,!1,8,t.var.offset);break;case r.Texture:n.bindTexture(n.TEXTURE_2D,t.var),n.uniform1i(t.handle,0);break;case r.Matrix:n.uniformMatrix4fv(t.handle,!1,t.var.get());break;case r.Vec4:n.uniform4fv(t.handle,t.var);break;case r.Float:n.uniform1f(t.handle,t.var);break;case r.Instance:n.bindBuffer(n.ARRAY_BUFFER,t.var.id);for(let e=0;e<4;e++){const i=t.handle+e,s=16*e;n.enableVertexAttribArray(i),n.vertexAttribPointer(i,4,n.FLOAT,!1,64,s),n.vertexAttribDivisor(i,1)}}})}}class f{constructor(t){t instanceof ArrayBuffer&&(this.array=new Uint8Array(t)),t instanceof Uint8Array&&(this.array=t),this.offset=0}setOffset(t){this.offset=t}read(){return this.array[this.offset++]}readBytes(t){const e=this.offset,i=this.offset+t;return this.offset=i,this.array.slice(e,i)}readUInt32(){const t=this.offset+4,e=this.array.slice(this.offset,t);return this.offset=t,e.reduce((t,e,i)=>e<<8*i|t)}readString(t){return new TextDecoder("utf-8").decode(this.readBytes(t))}}var m,v=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function a(t){try{h(n.next(t))}catch(t){r(t)}}function o(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}h((n=n.apply(t,e||[])).next())}))};class y{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}valueX(){return this.x}valueY(){return this.y}valueZ(){return this.z}copy(){return new y(this.x,this.y,this.z)}add(t){return new y(this.x+t.x,this.y+t.y,this.z+t.z)}subtract(t){return new y(this.x-t.x,this.y-t.y,this.z-t.z)}multiply(t){return new y(this.x*t.x,this.y*t.y,this.z*t.z)}division(t){return new y(this.x/t.x,this.y/t.y,this.z/t.z)}equal(t,e){const i=this.x-t.x,n=this.y-t.y,s=this.z-t.z;return Math.sqrt(i*i+n*n+s*s)<e}directionAngle(t){const e=t*Math.PI/180;return new y(this.x+Math.sin(e),this.y+Math.cos(e),0)}directionRadius(t){return new y(this.x+Math.sin(t),this.y+Math.cos(t),0)}reversDirectionRadius(t){return new y(this.x-Math.sin(t),this.y-Math.cos(t),0)}dot(t){const e=this.multiply(t);return e.x+e.y+e.z}}!function(t){t[t.Perspective=0]="Perspective",t[t.Ortho=1]="Ortho",t[t.None=2]="None"}(m||(m={}));class w extends d{constructor(t,e=m.Perspective,i=70,n=.001,s=20){super(),this.name=t,this.fov=i,this.type=e,this.distance={near:n,far:s},this.aspect=0}useAsCurrent(){g=this}identity(){switch(super.identity(),this.aspect=s.width/s.height,this.type){case m.Perspective:this.perspective(this.fov,this.aspect,this.distance.near,this.distance.far)}}setFov(t){this.fov=t}zoom(t){this.scale(new y(t,t,t))}getView(){return this}}var g=new w("default");class b{constructor(t=1,e=1,i=1,n=1){this.r=t,this.g=e,this.b=i,this.a=n}setRGBA(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n}valueR(){return this.r}valueG(){return this.g}valueB(){return this.b}valueA(){return this.a}}var x=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function a(t){try{h(n.next(t))}catch(t){r(t)}}function o(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}h((n=n.apply(t,e||[])).next())}))};class E{constructor(){this.origin={translation:new y,scale:new y,rotate:new y},this.view=new d}createInstance(t){const e=new Float32Array(16*t.length);t.forEach((t,i)=>{e.set(t.get(),16*i)}),this.instance.count=t.length,n.bindBuffer(n.ARRAY_BUFFER,this.instance.id),n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)}updateInstance(t,e){n.bindBuffer(n.ARRAY_BUFFER,this.instance.id),n.bufferSubData(n.ARRAY_BUFFER,64*t,e.get())}render(){this.shader.setTexture(this.texture),this.shader.setViewport(this.view),this.shader.setCamera(g),this.shader.setColor(this.color),this.shader.setVertex(this.vertex),this.shader.setUV(this.uv),this.shader.setInstance(this.instance),this.shader.update(),n.drawArraysInstanced(n.TRIANGLES,0,this.vertex.count,this.instance.count)}}function A(t){return x(this,void 0,void 0,(function*(){const e=yield function(t){return v(this,void 0,void 0,(function*(){const e=yield(yield(yield fetch(t)).blob()).arrayBuffer(),i=new f(e),n=t=>{throw t};1179937895!==i.readUInt32()&&n("this is not glTF file"),2!==i.readUInt32()&&n("this file is incompatible witch glTF version 2"),i.readUInt32();const s=i.readUInt32(),r=(t,e)=>{switch(t){case 1313821514:return JSON.parse(i.readString(e));case 5130562:return i.readBytes(e);default:n("Something wrong with chunk type")}},a=r(i.readUInt32(),s);return a.buffers.forEach(t=>{const e=i.readUInt32();t.uri=r(i.readUInt32(),e)}),a}))}(t),i=new Map,s=new p,r=n.createTexture(),a=new f(e.buffers[0].uri);a.setOffset(e.bufferViews[e.images[0].bufferView].byteOffset);const o=new Blob([a.readBytes(e.bufferViews[e.images[0].bufferView].byteLength)],{type:e.images[0].mimeType});t.split(/(\/|\\)/).reduce((t,e,i,n)=>i!==n.length-1?t+e:t);s.setTexture(r);const h=new Image;h.src=URL.createObjectURL(o),h.onload=()=>{n.bindTexture(n.TEXTURE_2D,r),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,h),n.generateMipmap(n.TEXTURE_2D)};const c=n.createBuffer();return n.bindBuffer(n.ARRAY_BUFFER,c),n.bufferData(n.ARRAY_BUFFER,e.buffers[0].uri,n.STATIC_DRAW),e.nodes.forEach((t,a)=>{const o=new E;o.color=new b,o.shader=s,o.shader.setViewport(o.view),o.shader.setColor(o.color),o.texture=r,o.origin.translation=new y(null==t.translation?0:t.translation[0],null==t.translation?0:t.translation[1],null==t.translation?0:t.translation[2]),o.origin.rotate=new y(null==t.rotation?0:t.rotation[0],null==t.rotation?0:t.rotation[1],null==t.rotation?0:t.rotation[2]),o.origin.scale=new y(null==t.scale?1:t.scale[0],null==t.scale?1:t.scale[1],null==t.scale?1:t.scale[2]);const h=e.meshes[t.mesh].primitives[0].attributes.POSITION,l=e.accessors[h].bufferView,u=e.meshes[t.mesh].primitives[0].attributes.TEXCOORD_0,p=e.accessors[u].bufferView;o.vertex={id:c,count:e.accessors[h].count,offset:e.bufferViews[l].byteOffset,size:e.bufferViews[l].byteLength},o.uv={id:c,count:e.accessors[u].count,offset:e.bufferViews[p].byteOffset,size:e.bufferViews[p].byteLength},o.instance={id:n.createBuffer(),count:1,offset:0,size:0},n.bindBuffer(n.ARRAY_BUFFER,o.instance.id),n.bufferData(n.ARRAY_BUFFER,(new d).get(),n.STATIC_DRAW),o.shader.setVertex(o.vertex),o.shader.setUV(o.uv),i.set(t.name,o)}),i}))}var R,S=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function a(t){try{h(n.next(t))}catch(t){r(t)}}function o(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}h((n=n.apply(t,e||[])).next())}))};!function(t){t[t.up=0]="up",t[t.down=1]="down",t[t.left=2]="left",t[t.right=3]="right"}(R||(R={}));class T{constructor(t,e,i=!0,n=null,s=0){this.node=t,this.id=s,this.rotate=0,this.trace=new Array(16),this.parent=n,this.direction=R.up,this.position=e.add(t.origin.translation),this.size=t.origin.scale,this.view=new d,this.visible=i,this.tracePosition={start:8,end:0,gap:8},this.trace.fill({position:this.position.add(new y(1,1,1)),direction:this.rotate})}setColor(t,e,i,n){this.node.color.setRGBA(t,e,i,n)}collisionWithObject(t,e){return!!(t.visible&&this.visible&&this.position.equal(t.position,e))}collisionWithWall(t){return!!this.visible&&t.collisionToVec3(this.position)}show(){this.visible=!0}hide(){this.visible=!1}lastPosition(){return this.trace[this.tracePosition.end]}currentPosition(){return this.position}changeCurrentPosition(t){this.position=t}changeParent(t){this.parent=t}callParent(){return this.parent}changeSize(t){this.size=t}lookDirection(t){this.direction=t}rotateAt(t){this.rotate=t}resize(t){this.size=t}move(t){switch(this.direction){case R.up:this.position=this.position.add(new y(0,t,0)),this.rotate=u(0);break;case R.down:this.position=this.position.add(new y(0,-t,0)),this.rotate=u(180);break;case R.left:this.position=this.position.add(new y(-t,0,0)),this.rotate=u(-90);break;case R.right:this.position=this.position.add(new y(t,0,0)),this.rotate=u(90)}}update(){this.trace[this.tracePosition.start]={position:this.position,direction:this.rotate},this.tracePosition.start++,this.tracePosition.end++,this.tracePosition.start>this.tracePosition.gap&&(this.tracePosition.start=0),this.tracePosition.end>this.tracePosition.gap&&(this.tracePosition.end=0),this.visible&&(this.view.identity(),this.view.translate(this.position),this.view.scale(this.size),this.view.rotateZ(this.rotate),this.node.updateInstance(this.id,this.view))}render(){this.visible&&this.node.render()}}class I{constructor(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}collisionToVec3(t){return this.x<t.valueX()+.1&&this.x+this.width>t.valueX()&&this.y<t.valueY()+.1&&this.y+this.height>t.valueY()}}var P=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function a(t){try{h(n.next(t))}catch(t){r(t)}}function o(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}h((n=n.apply(t,e||[])).next())}))};class U{constructor(t,e,i=0,n=0){this.whxy=new Int32Array(4),this.whxy[0]=t,this.whxy[1]=e,this.whxy[2]=i,this.whxy[3]=n}get position(){return this.whxy[0]>this.whxy[2]&&this.whxy[2]>=0&&this.whxy[1]>this.whxy[3]&&this.whxy[3]>=0?this.whxy[2]*this.whxy[0]+this.whxy[3]:0}set x(t){this.whxy[2]=t}get x(){return this.whxy[2]}set y(t){this.whxy[3]=t}get y(){return this.whxy[3]}get print(){return`width:${this.whxy[0]}\nheight:${this.whxy[1]}\nx:${this.whxy[2]}\ny:${this.whxy[3]}`}}function C(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}window.onload=()=>{(new class extends class{constructor(){var t;t="#glCanvas",s=document.querySelector(t),null===(n=s.getContext("webgl2",{stencil:!0}))&&alert("Unable to initialize WebGL2. Your browser or machine may not support it."),n.enable(n.DEPTH_TEST),n.enable(n.STENCIL_TEST),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.stencilOp(n.KEEP,n.KEEP,n.REPLACE)}run(){return S(this,void 0,void 0,(function*(){yield this.init();let t=0,e=0,i=0;const r=()=>{for(e=performance.now(),t+=Math.min(1,(e-i)/1e3),n.clearColor(0,0,0,1),n.clearStencil(0),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT|n.STENCIL_BUFFER_BIT),o(),n.viewport(0,0,s.width,s.height);t>1/60;)t-=1/60,this.update(1/60);this.render(t),i=e,requestAnimationFrame(r)};requestAnimationFrame(r)}))}}{constructor(){super()}init(){return P(this,void 0,void 0,(function*(){o(),this.start=0,this.screenAngle=window.screen.orientation.angle;this.pos2D=new U(64,64,32,32),window.addEventListener("fullscreenchange",t=>{!function(){const t=document.getElementById("dpad").style;"visible"===t.visibility?t.visibility="hidden":t.visibility="visible"}()}),window.addEventListener("orientationchange",t=>{this.screenAngle=t.target.screen.orientation.angle}),document.querySelector("#input").addEventListener("click",t=>{"fullScreen"===t.target.id&&(C(),this.speed=0,document.getElementById("end").style.visibility="visible"),"start"===t.target.id&&(function(){const t=window.matchMedia;return!!t&&t("(pointer:coarse)").matches}()&&C(),document.getElementById("start").style.visibility="hidden",this.start=22),"restart"===t.target.id&&(document.getElementById("end").style.visibility="hidden",this.speed=.9,this.direction=R.up,this.head.changeCurrentPosition(this.pos),this.snakeSize=1,this.tail.changeParent(this.midleSnakeNode[0]),this.midleSnakeInstance.forEach(t=>t.scale(new y(0,0,0))),e.createInstance(this.midleSnakeInstance),document.documentElement.requestFullscreen())}),document.querySelector("#input").addEventListener("touchstart",t=>{"left"===t.target.id&&this.direction!==R.right&&this.direction!==R.left&&(this.direction=R.left),"right"===t.target.id&&this.direction!==R.left&&this.direction!==R.right&&(this.direction=R.right),"up"===t.target.id&&this.direction!==R.down&&this.direction!==R.up&&(this.direction=R.up),"down"===t.target.id&&this.direction!==R.up&&this.direction!==R.down&&(this.direction=R.down)}),window.addEventListener("keydown",t=>{"e"===t.key&&console.log(document.fullscreenElement),"a"===t.key&&this.direction!==R.right&&this.direction!==R.left&&(this.direction=R.left),"d"===t.key&&this.direction!==R.left&&this.direction!==R.right&&(this.direction=R.right),"w"===t.key&&this.direction!==R.down&&this.direction!==R.up&&(this.direction=R.up),"s"===t.key&&this.direction!==R.up&&this.direction!==R.down&&(this.direction=R.down)});const t=yield A("./data/snake.glb");this.arena=t.get("arena"),this.cam=new w("main"),this.cam.useAsCurrent(),this.direction=R.up,this.arenaSpawnPoint=new Array(4096);for(let t=0;t<64;t++)for(let e=0;e<64;e++){new d;this.pos2D.x=e,this.pos2D.y=t,this.arenaSpawnPoint[this.pos2D.position]=new y(.06*e,.06*t,5e-4)}this.arena.view.translate(new y(1.92,1.92,0)),this.speed=.9,this.pos2D.x=32,this.pos2D.y=0,this.pos=this.arenaSpawnPoint[this.pos2D.position],this.pos=this.pos.add(new y(0,0,0));this.midleSnakeInstance=new Array(500),this.midleSnakeNode=new Array(500),this.head=new T(t.get("head"),this.pos);let e=t.get("midle");for(let t=0;t<500;t++)this.midleSnakeInstance[t]=new d,this.midleSnakeInstance[t].scale(new y(0,0,0)),this.midleSnakeNode[t]=new T(e,this.pos,0==t,0==t?this.head:this.midleSnakeNode[t-1],t);e.createInstance(this.midleSnakeInstance),this.head.lookDirection(R.up),this.tail=new T(t.get("tail"),this.pos,!0,this.midleSnakeNode[0]);const i=l(0,this.arenaSpawnPoint.length);this.up=new T(t.get("up"),new y(this.arenaSpawnPoint[i].valueX(),this.arenaSpawnPoint[i].valueY())),this.snakeSize=1,this.head.setColor(0,0,1,.5),this.midleSnakeNode[0].setColor(0,0,1,.5),this.tail.setColor(0,0,1,.5),this.up.setColor(1,1,1,.5),this.arena.color.setRGBA(.2,.2,.2,1),this.wall=new I(0,0,3.95,3.95)}))}camera(t){}update(t){switch(this.start){case 20:this.start=21;break;case 21:return;case 22:break;default:this.start++}this.cam.identity(),this.cam.rotateX(.2),0!=this.screenAngle?(this.cam.position(new y(-2.1,-.8,-2)),this.cam.zoom(.74)):(this.cam.position(new y(-.75,.1,-2)),this.cam.zoom(.39)),this.head.lookDirection(this.direction),this.head.move(this.speed*t),this.midleSnakeNode.forEach((t,e)=>{const i=t.callParent().lastPosition();t.changeCurrentPosition(i.position),t.rotateAt(i.direction),this.snakeSize>e?t.show():t.hide(),t.update(),!this.head.collisionWithObject(t,.03)&&this.head.collisionWithWall(this.wall)||(this.speed=0,document.getElementById("end").style.visibility="visible")});const e=this.tail.callParent().lastPosition();if(this.tail.changeCurrentPosition(e.position),this.tail.rotateAt(e.direction),this.tail.update(),this.head.update(),this.head.collisionWithObject(this.up,.1)){const t=l(0,this.arenaSpawnPoint.length);this.up.changeCurrentPosition(this.arenaSpawnPoint[t]),this.tail.changeParent(this.midleSnakeNode[this.snakeSize]),this.snakeSize++}this.up.update()}render(t){this.arena.render(),this.up.render(),this.head.render(),this.midleSnakeNode[0].render(),this.tail.render()}}).run()}}]);