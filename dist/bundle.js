!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e){t.exports="<html> <body> <canvas id=glCanvas width=640 height=480></canvas> </body> </html>"},function(t,e,r){"use strict";r.r(e);class n{constructor(t){t instanceof ArrayBuffer&&(this.array=new Uint8Array(t)),t instanceof Uint8Array&&(this.array=t),this.position=0}read(){return this.array[this.position++]}readBytes(t){const e=this.position,r=this.position+t;return this.position=r,this.array.slice(e,r)}readUInt32(){const t=this.position+4,e=this.array.slice(this.position,t);return this.position=t,e.reduce((t,e,r)=>e<<8*r|t)}readString(t){return new TextDecoder("utf-8").decode(this.readBytes(t))}}var i=function(t,e,r,n){return new(r||(r=Promise))((function(i,a){function o(t){try{u(n.next(t))}catch(t){a(t)}}function s(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}u((n=n.apply(t,e||[])).next())}))};r(0);function a(t,e,r){const n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS))return n;console.log(t.getShaderInfoLog(n)),t.deleteShader(n)}class o{constructor(){this.mat=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}translate(t,e,r){const n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,r,1]);this.mat=this.multiplyMatrices4x4(this.mat,n)}scale(t,e,r){const n=new Float32Array([t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1]);this.mat=this.multiplyMatrices4x4(this.mat,n)}rotateX(t){const e=Math.cos(t),r=-Math.sin(t),n=new Float32Array([1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1]);this.mat=this.multiplyMatrices4x4(this.mat,n)}rotateY(t){const e=Math.cos(t),r=-Math.sin(t),n=new Float32Array([e,0,-r,0,0,1,0,0,r,0,e,0,0,0,0,1]);this.mat=this.multiplyMatrices4x4(this.mat,n)}rotateZ(t){const e=Math.cos(t),r=-Math.sin(t),n=new Float32Array([e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1]);this.mat=this.multiplyMatrices4x4(this.mat,n)}reset(){this.mat=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}multiplyMatrices4x4(t,e){return new Float32Array([e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15]])}}window.onload=()=>{const t=document.querySelector("#glCanvas").getContext("webgl2");if(null===t)return void alert("Unable to initialize WebGL. Your browser or machine may not support it.");const e=a(t,t.VERTEX_SHADER,"#version 300 es\nin vec4 a_position;\nuniform mat4 u_matrix;\nin vec2 a_texCord;\nout vec2 v_texCord;\nvoid main() {\n\tv_texCord = a_texCord;\n  gl_Position = u_matrix * a_position;\n}\n"),r=a(t,t.FRAGMENT_SHADER,"#version 300 es\nprecision mediump float;\nuniform sampler2D u_image;\nin vec2 v_texCord;\nout vec4 outColor;\nvoid main() {\n  outColor = texture(u_image, v_texCord);\n}\n"),s=function(t,e,r){const n=t.createProgram();if(t.attachShader(n,e),t.attachShader(n,r),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS))return n;console.log(t.getProgramInfoLog(n)),t.deleteProgram(n)}(t,e,r),u=t.getAttribLocation(s,"a_position"),c=t.getUniformLocation(s,"u_matrix"),f=t.getAttribLocation(s,"a_texCord"),l=t.getUniformLocation(s,"u_image"),d=t.createBuffer(),h=t.createBuffer(),m=t.createTexture(),y=function(t){return i(this,void 0,void 0,(function*(){const e=yield(yield(yield fetch(t)).blob()).arrayBuffer(),r=new n(e),i=t=>{throw t};1179937895!==r.readUInt32()&&i("this is not glTF file"),2!==r.readUInt32()&&i("this file is incompatible witch glTF version 2"),r.readUInt32();const a=r.readUInt32(),o=(t,e)=>{switch(t){case 1313821514:return JSON.parse(r.readString(e));case 5130562:return r.readBytes(e);default:i("Something wrong with chunk type")}},s=o(r.readUInt32(),a);return s.buffers.forEach(t=>{const e=r.readUInt32();t.uri=o(r.readUInt32(),e)}),console.log(s),s}))}("./data/test.glb"),T=new o;T.translate(.5,.5,.5);let _=.1;y.then(e=>{t.enable(t.DEPTH_TEST);const r=new n(e.buffers[0].uri);r.position=e.bufferViews[4].byteOffset;const i=new Blob([r.readBytes(e.bufferViews[4].byteLength)],{type:e.images[0].mimeType}),a=URL.createObjectURL(i),o=new Image;o.src=a,o.onload=()=>{t.bindTexture(t.TEXTURE_2D,m),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o)},console.log(o),t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,e.buffers[0].uri,t.STATIC_DRAW,e.bufferViews[0].byteOffset,e.bufferViews[0].byteLength),t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,e.buffers[0].uri,t.STATIC_DRAW,e.bufferViews[2].byteOffset,e.bufferViews[2].byteLength);const y=()=>{_+=.01,T.rotateY(_),T.rotateZ(_),t.clearColor(0,.5,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.viewport(0,0,t.canvas.width,t.canvas.height),t.useProgram(s),t.uniformMatrix4fv(c,!1,T.mat),t.bindBuffer(t.ARRAY_BUFFER,h),t.enableVertexAttribArray(f),t.vertexAttribPointer(f,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,m),t.uniform1i(l,0),t.enableVertexAttribArray(u),t.bindBuffer(t.ARRAY_BUFFER,d),t.vertexAttribPointer(u,3,t.FLOAT,!1,0,0),t.drawArrays(t.TRIANGLES,0,e.accessors[0].count),T.reset(),requestAnimationFrame(y)};y()})}}]);